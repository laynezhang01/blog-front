---
title: HTTP, HTTPS, TCP
createdAt: 2024-11-26 18:00:00
tags: HTTP, HTTPS, TCP
category: 网络基础
location: 深圳
summary: 一些http、https、tcp的基础知识，包括了url输入到渲染的过程
---

## TCP

TCP是一种面向连接的、可靠的、基于字节流的传输层通信协议。

有关于TCP的芝士有点多，以后再深入研究。目前就只是简单看一下。

### 三次握手

三次握手是建立连接的过程，先由客户端发送SYN包给服务端请求建立连接，再由服务端发送SYN+ACK包给服务端确定建立连接，然后客户端发送ACK建立完成。

为什么发送三次，是因为防止某些网络滞留问题，导致一些问题。

### 四次挥手

处于连接的服务端和客户端都可以关闭连接，假设是客户端请求关闭：

客户端发送一个FIN包给服务端，然后进入等待关闭1状态，此时是第一次挥手。

服务端接受FIN包，发送ACK包，确定进入等待关闭状态，客户端进入等待关闭2状态，此时还可以接收服务端消息，服务端也还可以发送未发送消息。此时是第二次挥手。

服务端确定发送完数据以后，会发送FIN包给客户端，进入最后确认状态。这次第三次挥手，立即关闭连接。

客户端收到回复ACK包，进入超时等待状态，最后关闭连接，这就是第四次挥手。

那么为什么要有等待时间呢，是防止因为网络问题，服务端没有接受到最后的ack包，如果没有接收到ack包，服务端会重新发送fin包给客户端。

## http和https

这里也有很多学问，也只是做一些简单的理解

http：超文本传输协议，用于浏览器之间传递信息的，是以明文形式传输，所以信息有可能被劫持，比如在一些公用wifi之类的情况下，很容易被劫持敏感信息。

https：超文本安全传输协议，是在http基础上增加了SSL，所谓的安全就是使用SSL进行了加密传输。

区别：https需要申请证书，需要成本，https是加密传输，https端口是443，http是80。那么https由于加入了SSL，所以从响应速度上会略慢于http，而服务器资源的开销上也更大一些。

至于http的原理，大致上就是服务器会传递公匙（证书）给客户端，客户端拿到后对内容进行加密，加密后传递给服务端，服务端拿私匙进行解密。

## 从输入URL到页面展示发生了什么

1. 先进行DNS解析，找到网址的对应IP，这一步可以做一些DNS缓存上的优化，比如DNS预解析，link的dns-prefetch属性，以及CDN分发内容等

2. 建立TCP连接，三次握手

3. 发送HTTP请求报文给服务器，报文包含请求行、请求头、空行、请求数据，服务器接收到后进行解析然后返回信息

4. 关闭TCP连接，四次挥手

5. 浏览器渲染

   1、渲染进程将HTML内容转换为浏览器能够读懂的DOM树结构。

   2、渲染引擎将CSS样式表转化为浏览器可以理解的styleSheets，计算出DOM节点的样式。

   3、创建布局树，并计算元素的布局信息。

   4、对布局树进行分层，并生成分层树。

   5、为每个图层生成绘制列表，并将其提交到合成线程。

   6、合成线程将图层分图块，并栅格化将图块转换成位图。

   7、合成线程发送绘制图块命令给浏览器进程。浏览器进程根据指令生成页面，并显示到显示器上。

   这个过程里的优化无非是script标签要注意摆放位置，可以使用defer、async属性进行异步加载，defer和async的区别是，defer会等待dom加载完毕后执行脚本，async则是不会等待dom加载完成。

   注意css书写可以避免一些回流的情况

   减少DOM操作，缓存DOM操作避免过度触发回流

   HTML文档层次尽量少...
